<!DOCTYPE html><html><head><meta charset="utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" name="viewport"><link rel="alternate icon" type="image/png" href="/img/favicon.png"><title>Hello world |</title><link rel="stylesheet" href="/css/reset.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/markdown.css"><link rel="stylesheet" href="/css/fonts.css"><meta name="generator" content="Hexo 7.0.0"></head><body><div class="paper"><div class="paper-main"><div class="post-header"><a class="logo" href="/">Hello world</a> <a class="go-home" href="/"><svg width="8" height="14" viewBox="0 0 8 14"><path d="M7 1L1 7l6 6" stroke="#000" stroke-width="2" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"/></svg></a></div><div class="post-main"><div class="post-main-title">PM2 命令使用方法总结</div><div class="post-meta">2023-11-06</div><div class="post-md"><h2 id="pm2是什么？"><a href="#pm2是什么？" class="headerlink" title="pm2是什么？"></a>pm2是什么？</h2><p>PM2是 node 进程管理工具，可以利用它来简化很多node应用管理的繁琐任务，这里推荐一个 node 版本控制工具–nvm。</p><h2 id="为什么要用pm2"><a href="#为什么要用pm2" class="headerlink" title="为什么要用pm2?"></a>为什么要用pm2?</h2><p>对于线上项目，如果直接通过 node app 来启动，因为 node 是单线程的，所以如果报错了可能会使项目直接停止，从而导致整个服务崩溃。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">一般监控 node 有几种方案：</span><br><span class="line">  1.supervisor: 一般用作开发环境的使用；</span><br><span class="line">  2.forever: 管理多个站点，一般每个站点的访问量不大的情况，不需要监控；</span><br><span class="line">  3.PM2: 网站的访问量比较大，需要完整的监控页面。</span><br></pre></td></tr></table></figure><h2 id="pm2优点"><a href="#pm2优点" class="headerlink" title="pm2优点"></a>pm2优点</h2><ul><li>后台运行(关掉cmd窗口依然运行)</li><li>0 秒停机重载，维护升级时不需要停机</li><li>Linux (stable) &amp; MacOSx (stable) &amp; Windows (stable).多平台支持</li><li>进程守护 (停止不稳定的进程，避免无限循环)</li><li>内建负载均衡</li><li>实时控制台检测</li><li>提供 HTTP API等</li><li>远程控制和实时的接口API ( nodejs 模块,允许和PM2进程管理器交互 )</li><li>不仅仅可以启动node程序，对于一般的脚本程序同样可以</li></ul><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p><strong>确保有node环境</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g pm2</span><br></pre></td></tr></table></figure><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><h3 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 start app.js</span><br></pre></td></tr></table></figure><p>（如果提示找不到命令且你已安装成功，则可能你没有配置环境变量，需要自己手动配一下）</p><h4 id="参数说明："><a href="#参数说明：" class="headerlink" title="参数说明："></a>参数说明：</h4><ul><li>–watch：监听应用目录的变化，一旦发生变化，自动重启。如果要精确监听、不见听的目录，最好通过配置文件。</li><li>-i –instances：启用多少个实例，可用于负载均衡。如果-i 0或者-i max，则根据当前机器核数确定实例数目。</li><li>–ignore-watch：排除监听的目录&#x2F;文件，可以是特定的文件名，也可以是正则。比如–ignore-watch&#x3D;”test node_modules “</li><li>-n –name：指定应用的名称。查看应用信息的时候可以用到。</li><li>-o –output<path>：标准输出日志文件的路径。</path></li><li>-e –error<path>：错误输出日志文件的路径。</path></li><li>–interpreter<interpreter>：the interpreter pm2 should use for executing app (bash, python…)。比如你用的coffee script来编写应用。</interpreter></li><li>-x：用fork模式启动app.js，而不是cluster模式</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">  - fork模式：单实例多进程，常用于多语言混编，比如php、python等，不支持端口复用，需要自己做应用的端口分配和负载均衡的子进程业务代码。</span><br><span class="line">   缺点：就是单服务器实例容易由于异常会导致服务器实例崩溃。</span><br><span class="line"></span><br><span class="line">  - cluster模式：多实例多进程，但是只支持node，端口可以复用，不需要额外的端口配置，0代码实现负载均衡。</span><br><span class="line">   优点：就是由于多实例机制，可以保证服务器的容错性，就算出现异常也不会使多个服务器实例同时崩溃。</span><br><span class="line"></span><br><span class="line">例子：</span><br><span class="line">pm2 start app.js --watch：实时监控的方式启动，app.js文件有变动时，pm2会自动reload(重启)   </span><br><span class="line">pm2 start app.js -i max：根据有效CPU数目启动最大进程数目   </span><br><span class="line">pm2 start app.js -i 3：启动3个进程   </span><br><span class="line">pm2 start app.js --ignore-watch=&quot;test node_modules&quot;:排除监听的目录/文件   </span><br><span class="line">pm2 start app.js --name mynode：启动一个进程并把它命名为mynode   </span><br><span class="line">pm2 start app.json：启动进程, 可以在 app.json里设置选项   </span><br><span class="line">pm2 start app.js -i max - -z 10：在 – 之后给 app.js 传递参数（-z 10）  </span><br></pre></td></tr></table></figure><h3 id="查看与监视进程"><a href="#查看与监视进程" class="headerlink" title="查看与监视进程"></a>查看与监视进程</h3><p>pm2 list：显示所有进程信息；<br>pm2 show 11，pm2 info 11：查看进程id为 11 的详细信息；<br>pm2 monit：进入监视页面，监视每个node进程的CPU和内存的使用情况。</p><h3 id="重载、重启"><a href="#重载、重启" class="headerlink" title="重载、重启"></a>重载、重启</h3><p>pm2 restart 11：重启id为 11 的进程；<br>pm2 restart all：重启所有进程；<br>pm2 reload 11：0秒停机重载id为 11 进程（用于 NETWORKED 进程）；<br>pm2 reload all：重载所有进程；</p><h3 id="停止、删除进程"><a href="#停止、删除进程" class="headerlink" title="停止、删除进程"></a>停止、删除进程</h3><p>pm2 stop&#x2F;delete 11：停止&#x2F;删除id为 11 的进程；<br>pm2 stop&#x2F;delete all：停止&#x2F;删除所有进程；</p><h3 id="日志操作"><a href="#日志操作" class="headerlink" title="日志操作"></a>日志操作</h3><p>pm2 logs：显示所有进程的日志；<br>pm2 logs 11：显示进程id为 11 的日志；<br>pm2 flush：清空所有日志文件；<br>pm2 reloadLogs：重载所有日志；<br>pm2 startup：产生 init 脚本，保持进程活着；</p><h3 id="杀进程"><a href="#杀进程" class="headerlink" title="杀进程"></a>杀进程</h3><p>pm2 kill：杀死pm2进程 ;</p><h3 id="开机自动启动"><a href="#开机自动启动" class="headerlink" title="开机自动启动"></a>开机自动启动</h3><p>1、通过pm2 save保存当前进程状态。<br>2、通过pm2 startup [platform]生成开机自启动的命令。例如：pm2 startup centeros<br>3、将步骤2生成的命令，粘贴到控制台进行，搞定。</p></div></div><div class="footer"><span>Copyright © 2022 Hello world</span> <span>Theme Designed By <a target="_blank" href="https://zheli.design/one-paper">這李設計</a></span></div><link rel="stylesheet" href="/css/a11y-dark.min.css"><script src="/js/highlight.min.js"></script><script src="/js/highlightjs-line-numbers.js"></script><script>hljs.initHighlightingOnLoad(),hljs.initLineNumbersOnLoad()</script></div></div></body></html>